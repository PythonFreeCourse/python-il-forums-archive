<!DOCTYPE html>

<html lang="he">
<!-- Mirrored from forums.pythonic.guru/t/client-fixtures/9127 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 17 Sep 2023 02:51:12 GMT -->
<!-- Added by HTTrack --><meta content="text/html;charset=utf-8" http-equiv="content-type"/><!-- /Added by HTTrack -->
<head>
<meta charset="utf-8"/>
<title>ריבוי client fixtures - שבוע 16 - פייתון בעברית ובחינם</title>
<meta content="אני מסתכל באוסף המרשים של ה client fixtures שיש לנו בקוד ואני תוהה על מהותם. אני מבין שהרוב פשוט העתיקו מה שהם ראו שאחרים עשו, אבל אולי המישהו המקורי יכול להסביר למה כל ראוט צריך אחד משלו? 
חלק מהקוד: 
def create_test_cl&amp;hellip;" name="description"/>
<meta content="Discourse 3.2.0.beta2-dev - https://github.com/discourse/discourse version ebe68e15fce9c2fc2c67628ce4a9b24284c09b80" name="generator"/>
<link href="../../uploads/default/optimized/1X/49c4c7d93c7e73a9a15013cfae1d89084c9ba521_2_32x32.jpg" rel="icon" type="image/png"/>
<link href="../../uploads/default/optimized/1X/49c4c7d93c7e73a9a15013cfae1d89084c9ba521_2_180x180.jpg" rel="apple-touch-icon" type="image/png"/>
<meta content="#ffffff" media="all" name="theme-color"/>
<meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, user-scalable=yes, viewport-fit=cover" name="viewport"/>
<link href="9127.html" rel="canonical"/>
<link href="../../opensearch.xml" rel="search" title="פייתון בעברית ובחינם Search" type="application/opensearchdescription+xml"/>
<link class="light-scheme" href="../../stylesheets/color_definitions_scheme_2_3_4eaabccdb423ebdd5fde62bb8c929b7912b0ba33.css_%3b%20filename_%3dUTF-8%27%27color_definitions_scheme_2_3_4eaabccdb423ebdd5fde62bb8c929b7912b0ba337939.css?__ws=forums.pythonic.guru" media="all" rel="stylesheet"/>
<link data-target="desktop_rtl" href="../../stylesheets/desktop_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce.css_%3b%20filename_%3dUTF-8%27%27desktop_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce7939.css?__ws=forums.pythonic.guru" media="all" rel="stylesheet"/>
<link data-target="checklist_rtl" href="../../stylesheets/checklist_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce.css_%3b%20filename_%3dUTF-8%27%27checklist_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce7939.css?__ws=forums.pythonic.guru" media="all" rel="stylesheet"/>
<link data-target="discourse-cakeday_rtl" href="../../stylesheets/discourse-cakeday_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce.css_%3b%20filename_%3dUTF-8%27%27discourse-cakeday_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce7939.css?__ws=forums.pythonic.guru" media="all" rel="stylesheet"/>
<link data-target="discourse-calendar_rtl" href="../../stylesheets/discourse-calendar_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce.css_%3b%20filename_%3dUTF-8%27%27discourse-calendar_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce7939.css?__ws=forums.pythonic.guru" media="all" rel="stylesheet"/>
<link data-target="discourse-details_rtl" href="../../stylesheets/discourse-details_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce.css_%3b%20filename_%3dUTF-8%27%27discourse-details_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce7939.css?__ws=forums.pythonic.guru" media="all" rel="stylesheet"/>
<link data-target="discourse-lazy-videos_rtl" href="../../stylesheets/discourse-lazy-videos_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce.css_%3b%20filename_%3dUTF-8%27%27discourse-lazy-videos_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce7939.css?__ws=forums.pythonic.guru" media="all" rel="stylesheet"/>
<link data-target="discourse-local-dates_rtl" href="../../stylesheets/discourse-local-dates_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce.css_%3b%20filename_%3dUTF-8%27%27discourse-local-dates_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce7939.css?__ws=forums.pythonic.guru" media="all" rel="stylesheet"/>
<link data-target="discourse-math_rtl" href="../../stylesheets/discourse-math_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce.css_%3b%20filename_%3dUTF-8%27%27discourse-math_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce7939.css?__ws=forums.pythonic.guru" media="all" rel="stylesheet"/>
<link data-target="discourse-narrative-bot_rtl" href="../../stylesheets/discourse-narrative-bot_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce.css_%3b%20filename_%3dUTF-8%27%27discourse-narrative-bot_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce7939.css?__ws=forums.pythonic.guru" media="all" rel="stylesheet"/>
<link data-target="discourse-presence_rtl" href="../../stylesheets/discourse-presence_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce.css_%3b%20filename_%3dUTF-8%27%27discourse-presence_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce7939.css?__ws=forums.pythonic.guru" media="all" rel="stylesheet"/>
<link data-target="discourse-solved_rtl" href="../../stylesheets/discourse-solved_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce.css_%3b%20filename_%3dUTF-8%27%27discourse-solved_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce7939.css?__ws=forums.pythonic.guru" media="all" rel="stylesheet"/>
<link data-target="discourse-tooltips_rtl" href="../../stylesheets/discourse-tooltips_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce.css_%3b%20filename_%3dUTF-8%27%27discourse-tooltips_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce7939.css?__ws=forums.pythonic.guru" media="all" rel="stylesheet"/>
<link data-target="docker_manager_rtl" href="../../stylesheets/docker_manager_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce.css_%3b%20filename_%3dUTF-8%27%27docker_manager_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce7939.css?__ws=forums.pythonic.guru" media="all" rel="stylesheet"/>
<link data-target="poll_rtl" href="../../stylesheets/poll_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce.css_%3b%20filename_%3dUTF-8%27%27poll_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce7939.css?__ws=forums.pythonic.guru" media="all" rel="stylesheet"/>
<link data-target="discourse-calendar_desktop_rtl" href="../../stylesheets/discourse-calendar_desktop_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce.css_%3b%20filename_%3dUTF-8%27%27discourse-calendar_desktop_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce7939.css?__ws=forums.pythonic.guru" media="all" rel="stylesheet"/>
<link data-target="poll_desktop_rtl" href="../../stylesheets/poll_desktop_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce.css_%3b%20filename_%3dUTF-8%27%27poll_desktop_rtl_010e86cdc443c6a22fa77214fa3fc0bf2f3542ce7939.css?__ws=forums.pythonic.guru" media="all" rel="stylesheet"/>
<link data-target="desktop_theme" data-theme-id="3" data-theme-name="בהיר" href="../../stylesheets/desktop_theme_3_32d9a33a83c213d82cb6da72bd3eb36192a74400.css_%3b%20filename_%3dUTF-8%27%27desktop_theme_3_32d9a33a83c213d82cb6da72bd3eb36192a744007939.css?__ws=forums.pythonic.guru" media="all" rel="stylesheet"/>
<link href="9127.rss" rel="alternate nofollow" title="הזנת RSS של ‚ריבוי client fixtures’" type="application/rss+xml"/>
<meta content="פייתון בעברית ובחינם" property="og:site_name"/>
<meta content="website" property="og:type"/>
<meta content="summary" name="twitter:card"/>
<meta content="../../uploads/default/original/1X/49c4c7d93c7e73a9a15013cfae1d89084c9ba521.jpg" name="twitter:image"/>
<meta content="../../uploads/default/original/1X/49c4c7d93c7e73a9a15013cfae1d89084c9ba521.jpg" property="og:image"/>
<meta content="9127.html" property="og:url"/>
<meta content="9127.html" name="twitter:url"/>
<meta content="ריבוי client fixtures" property="og:title"/>
<meta content="ריבוי client fixtures" name="twitter:title"/>
<meta content="אני מסתכל באוסף המרשים של ה client fixtures שיש לנו בקוד ואני תוהה על מהותם. אני מבין שהרוב פשוט העתיקו מה שהם ראו שאחרים עשו, אבל אולי המישהו המקורי יכול להסביר למה כל ראוט צריך אחד משלו?  חלק מהקוד:  def create_test_client(get_db_function) -&gt; Generator[Session, None, None]:     Base.metadata.create_all(bind=test_engine)     main.app.dependency_overrides[get_db_function] = get_test_db      with TestClient(main.app) as client:         yield client      main.app.dependency_overrides = {}     Base..." property="og:description"/>
<meta content="אני מסתכל באוסף המרשים של ה client fixtures שיש לנו בקוד ואני תוהה על מהותם. אני מבין שהרוב פשוט העתיקו מה שהם ראו שאחרים עשו, אבל אולי המישהו המקורי יכול להסביר למה כל ראוט צריך אחד משלו?  חלק מהקוד:  def create_test_client(get_db_function) -&gt; Generator[Session, None, None]:     Base.metadata.create_all(bind=test_engine)     main.app.dependency_overrides[get_db_function] = get_test_db      with TestClient(main.app) as client:         yield client      main.app.dependency_overrides = {}     Base..." name="twitter:description"/>
<meta content="הקורס הפתוח" property="og:article:section"/>
<meta content="0088CC" property="og:article:section:color"/>
<meta content="שבוע 16" property="og:article:section"/>
<meta content="0088CC" property="og:article:section:color"/>
<meta name="twitter:label1" value="זמן קריאה"/>
<meta name="twitter:data1" value="1 mins 🕑"/>
<meta name="twitter:label2" value="לייקים"/>
<meta name="twitter:data2" value="1 ❤"/>
<meta content="2021-02-24T06:43:56+00:00" property="article:published_time"/>
<meta content="true" property="og:ignore_canonical"/>
<script type="application/ld+json">{"@context":"http://schema.org","@type":"QAPage","name":"ריבוי client fixtures","mainEntity":{"@type":"Question","name":"ריבוי client fixtures","text":"אני מסתכל באוסף המרשים של ה client fixtures שיש לנו בקוד ואני תוהה על מהותם. אני מבין שהרוב פשוט העתיקו מה שהם ראו שאחרים עשו, אבל אולי המישהו המקורי יכול להסביר למה כל ראוט צריך אחד משלו?\n\nחלק מהקוד:\n\ndef create_test_client(get_db_function) -&gt; Generator[Session, None, None]:\n\nBase.metadata.creat&hellip;","upvoteCount":1,"answerCount":0,"dateCreated":"2021-02-24T06:43:56.315Z","author":{"@type":"Person","name":"Gonny"}}}</script>
</head>
<body class="">
<header class="d-header">

<div class="wrap content">
<div class="title">
<a data-auto-route="true" href="/index.html">
<img alt="פייתון בעברית ובחינם" class="logo-big" id="site-logo" src="/uploads/default/original/1X/3c7e2ccc77e214fb4e38daa421f1b8878a5677f9.jpg"/>
</a>
<div class="before-header-panel-outlet"></div>
<div class="panel" role="navigation">
<span class="header-buttons"></span>
<ul class="icons d-header-icons">
<!-- More to come? -->
</ul>
</div>
</div>
</div></header>
<div class="wrap" id="main-outlet" role="main">
<div id="topic-title">
<h1>
<a href="9127.html">ריבוי client fixtures</a>
</h1>
<div class="topic-category" itemscope="" itemtype="http://schema.org/BreadcrumbList">
<span itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
<a class="badge-wrapper bullet" href="../../c/old/20.html" itemprop="item">
<span class="badge-category-bg" style="background-color: #0088CC"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">הקורס הפתוח</span>
</span>
</a>
<meta content="1" itemprop="position"/>
</span>
<span itemprop="itemListElement" itemscope="" itemtype="http://schema.org/ListItem">
<a class="badge-wrapper bullet" href="../../c/old/week-16/28.html" itemprop="item">
<span class="badge-category-bg" style="background-color: #0088CC"></span>
<span class="badge-category clear-badge">
<span class="category-name" itemprop="name">שבוע 16</span>
</span>
</a>
<meta content="2" itemprop="position"/>
</span>
</div>
</div>
<div itemscope="" itemtype="http://schema.org/DiscussionForumPosting">
<meta content="ריבוי client fixtures" itemprop="headline"/>
<meta content="שבוע 16" itemprop="articleSection"/>
<meta content="" itemprop="keywords"/>
<div itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
<meta content="פייתון בעברית ובחינם" itemprop="name"/>
<div itemprop="logo" itemscope="" itemtype="http://schema.org/ImageObject">
<meta content="../../uploads/default/original/1X/3c7e2ccc77e214fb4e38daa421f1b8878a5677f9.jpg" itemprop="url"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_1">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<span itemprop="name">gonny</span>
</span>
<link href="9127.html" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2021-02-24T06:43:56Z" itemprop="datePublished">
                     24 בפברואר,‏ 2021,‏  6:43am
                  </time>
<meta content="2021-02-24T06:43:56Z" itemprop="dateModified"/>
</span>
</div>
<div class="post" itemprop="articleBody">
<p>אני מסתכל באוסף המרשים של ה client fixtures שיש לנו בקוד ואני תוהה על מהותם. אני מבין שהרוב פשוט העתיקו מה שהם ראו שאחרים עשו, אבל אולי המישהו המקורי יכול להסביר למה כל ראוט צריך אחד משלו?</p>
<p>חלק מהקוד:</p>
<pre><code class>def create_test_client(get_db_function) -&gt; Generator[Session, None, None]:
    Base.metadata.create_all(bind=test_engine)
    main.app.dependency_overrides[get_db_function] = get_test_db

    with TestClient(main.app) as client:
        yield client

    main.app.dependency_overrides = {}
    Base.metadata.drop_all(bind=test_engine)


@pytest.fixture(scope="session")
def agenda_test_client() -&gt; Generator[TestClient, None, None]:
    yield from create_test_client(agenda.get_db)


@pytest.fixture(scope="session")
def friendview_test_client() -&gt; Generator[TestClient, None, None]:
    yield from create_test_client(friendview.get_db)


@pytest.fixture(scope="session")
def weight_test_client() -&gt; Generator[TestClient, None, None]:
    yield from create_test_client(weight.get_db)


@pytest.fixture(scope="session")
def event_test_client() -&gt; Generator[TestClient, None, None]:
    yield from create_test_client(event.get_db)

</code></pre>
<p>ממבט על הקוד, אפשר לראות שכל הפיקצ’ר-לראוט מעבירים את ה get_db מהמודול שלהם. בלי יוצא מן הכלל, אצל כולם זה</p>
<pre><code class>def get_db() -&gt; Session:
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()
</code></pre>
<p>שנמצא ב app/dependencies.py. אז מה המטרה פה בעצם?</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
<span class="post-likes">לייק 1</span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_2" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<span itemprop="name">itzik245</span>
</span>
<link href="9127.html" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2021-02-24T10:04:44Z" itemprop="datePublished">
                     24 בפברואר,‏ 2021,‏ 10:04am
                  </time>
<meta content="2021-02-24T10:04:44Z" itemprop="dateModified"/>
</span>
</div>
<div class="post" itemprop="text">
<p>אני לא בטוח כלכך, אבל לפי מה שזכור לי, בהתחלה כשניסיתי להשתמש ב client של מישהו אחר, זה איכשהו הפיל לי חלק מהבדיקות.</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_3" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<span itemprop="name">yuval.cagan</span>
</span>
<link href="9127.html" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2021-02-24T12:09:25Z" itemprop="datePublished">
                     24 בפברואר,‏ 2021,‏ 12:09pm
                  </time>
<meta content="2021-02-24T12:09:25Z" itemprop="dateModified"/>
</span>
</div>
<div class="post" itemprop="text">
<p>הפונקציה <code>create_test_client</code> יוצרת אוברייד ומחליפה את הפונקציה <code>get_db</code> באחת שמביאה. סשן של הדאטהבייס של הבדיקות.<br/>
להבנתי התהליך הזה דומה במהותו לפאטצ’ינג של פונקציה ולכן יש להגדיר את הפונקציה המדוייקת שמתחלפת בתוך המודול שנרצה לבדוק ולא הפונקציה המקורית. כלומר: צריך להחליף את <code>event.get_db</code> ולא את <code>dependencies.get_db</code>, אפילו שבפועל זו אותה הפונקציה מיובאת לתוך המודול.<br/>
בגלל הצורך בהחלפת הפונקציה מקומית בכל אחד מהמודולים באופן ספציפי, נוצר ריבוי של קליינטים שלמראית עין הוא זהה כמעט לחלוטין.</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="1" itemprop="userInteractionCount"/>
</div>
</div>
<div class="topic-body crawler-post" id="post_4" itemprop="comment" itemscope="" itemtype="http://schema.org/Comment">
<div class="crawler-post-meta">
<span class="creator" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
<span itemprop="name">gonny</span>
</span>
<link href="9127.html" itemprop="mainEntityOfPage"/>
<span class="crawler-post-infos">
<time class="post-time" datetime="2021-02-24T20:29:05Z" itemprop="datePublished">
                     24 בפברואר,‏ 2021,‏  8:29pm
                  </time>
<meta content="2021-02-24T20:29:05Z" itemprop="dateModified"/>
</span>
</div>
<div class="post" itemprop="text">
<p>אם זאת אותה פונקציה בדיוק, אין פה שום שינוי. מה אני מפספס?</p>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/LikeAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
<span class="post-likes"></span>
</div>
<div itemprop="interactionStatistic" itemscope="" itemtype="http://schema.org/InteractionCounter">
<meta content="http://schema.org/CommentAction" itemprop="interactionType"/>
<meta content="0" itemprop="userInteractionCount"/>
</div>
</div>
</div>
</div>
<footer class="container wrap">
</footer>
<span class_="highlight-scripts"><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css" rel="stylesheet"/><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/go.min.js"></script></span><span class_="highlight-scripts"><link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/default.min.css" rel="stylesheet"/><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/go.min.js"></script><script>hljs.highlightAll();</script></span></body>
<!-- Mirrored from forums.pythonic.guru/t/client-fixtures/9127 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 17 Sep 2023 02:51:13 GMT -->
</html>
